function withdrawPoints() {
  const amount = parseInt(document.getElementById('withdraw-amount').value);
  const phoneNumber = document.getElementById('phone-number').value;
  const paymentMethod = document.getElementById('payment-method').value;

  // Access Telegram username dynamically from WebApp data
  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;
  const telegramUsername = user ? user.username || 'No username': 'No username';

  if (isNaN(amount) || amount < 500 || amount > 10000 || !phoneNumber || !paymentMethod) {
    document.getElementById('withdraw-status').textContent = "Invalid withdrawal details (Min 500).";
    return;
  }

  let deductionAmount;
  switch (amount) {
    case 500:
      deductionAmount = 375000;
      break;
    case 1000:
      deductionAmount = 750000;
      break;
    case 10000:
      deductionAmount = 3500000;
      break;
    default:
      deductionAmount = 0;
  }

  // Cek apakah point cukup untuk penarikan
  if (earnedPoints < deductionAmount) {
    document.getElementById('withdraw-status').textContent = "Insufficient points for withdrawal.";
    return;
  }

  // Subtract the amount from earnedPoints
  earnedPoints -= deductionAmount;

  // Update the earned points on the UI
  document.getElementById('earned-points').textContent = earnedPoints;
  localStorage.setItem('earned-points', earnedPoints);
  const koinPerRupiah = 660;
  updateEarned(earnedPoints, koinPerRupiah);

  document.getElementById('withdraw-status').textContent = "Withdrawal request sent.";

  const adminChatId = '5308426585'; // Admin's Telegram chat ID
  const botToken = '7971014111:AAF23urpxpxjcphCJI6AM4KYWGN6lMsJ5Dc'; // Your bot's token

  const message = `New withdrawal request:\n\n` +
    `Amount: ${amount}\n` +
    `Phone number: ${phoneNumber}\n` +
    `Payment Methods: ${paymentMethod}\n` +
    `Username Telegram: @${telegramUsername}\n` +
    `Remaining Points: ${earnedPoints}`;

  // Include the remaining earned points in the message
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      chat_id: adminChatId,
      text: message
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.ok) {
      document.getElementById('withdraw-status').textContent += "\nAdmin successfully notified.";
    } else {
      document.getElementById('withdraw-status').textContent += "\nFailed to notify admin.";
    }
  })
  .catch(error => {
    console.error(error);
    document.getElementById('withdraw-status').textContent += "\nAn error occurred while contacting admin.";
  });

  // Reset the withdrawal form
  document.getElementById('withdraw-form').reset();
}
